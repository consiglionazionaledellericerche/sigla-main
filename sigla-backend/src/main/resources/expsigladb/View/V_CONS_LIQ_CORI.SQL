CREATE OR REPLACE VIEW PCIR009.V_CONS_LIQ_CORI
(CD_UO_LIQUIDAZIONE,PG_LIQUIDAZIONE,NUMERO_MANDATO,CD_GRUPPO_CR,DS_GRUPPO_CR,DS_REGIONE,DS_COMUNE,IM_LIQUIDATO,CD_CONTRIBUTO_RITENUTA,DS_CONTRIBUTO_RITENUTA,TI_ENTE_PERCIPIENTE,AMMONTARE,ESERCIZIO_COMPENSO,PG_COMPENSO,UO_COMPENSO,DS_UO_COMPENSO,DS_COMPENSO,RAGIONE_SOCIALE,COGNOME,NOME,ESERCIZIO_LIQUIDAZIONE,DS_UO_LIQUIDAZIONE,CD_CDS_DOC,ESERCIZIO_DOC,DT_DA,DT_A,DT_EMISSIONE,CD_REGIONE,PG_COMUNE,CODICE_FISCALE)
AS
SELECT DISTINCT lc.CD_UNITA_ORGANIZZATIVA CD_UO_LIQUIDAZIONE, lc.PG_LIQUIDAZIONE , lgc.PG_DOC numero_mandato, lgc.CD_GRUPPO_CR,  gc.DS_GRUPPO_CR,  r2.DS_REGIONE , c2.DS_COMUNE, ma.IM_MANDATO - nvl(ma.IM_RITENUTE,0), tcr.cd_CONTRIBUTO_RITENUTA, tcr.ds_CONTRIBUTO_RITENUTA,lgcd.TI_ENTE_PERCIPIENTe, cr.AMMONTARE, c3.ESERCIZIO ESERCIZIO_COMPENSO, c3.PG_COMPENSO, c3.CD_UNITA_ORGANIZZATIVA UO_COMPENSO, UO.DS_UNITA_ORGANIZZATIVA DS_UO_COMPENSO, c3.DS_COMPENSO , C3.RAGIONE_SOCIALE , c3.COGNOME , c3.NOME, lc.ESERCIZIO ESERCIZIO_LIQUIDAZIONE, UO2.DS_UNITA_ORGANIZZATIVA DS_UO_LIQUIDAZIONE, LGC.CD_CDS_DOC , LGC.ESERCIZIO_DOC, lc.dt_da, lc.dt_a, ma.dt_emissione, R2.CD_REGIONE ,C2.PG_COMUNE, c3.codice_fiscale
FROM LIQUID_CORI lc , LIQUID_GRUPPO_CORI lgc , LIQUID_GRUPPO_CORI lgc2 , LIQUID_GRUPPO_CORI_DET lgcd, GRUPPO_CR gc, REGIONE r2, COMUNE c2, TIPO_CONTRIBUTO_RITENUTA tcr, CONTRIBUTO_RITENUTA cr, COMPENSO c3, UNITA_ORGANIZZATIVA uo, UNITA_ORGANIZZATIVA uo2, mandato ma
WHERE lc.CD_CDS = lgc.CD_CDS AND
    lc.ESERCIZIO = lgc.ESERCIZIO AND
    lc.PG_LIQUIDAZIONE = lgc.PG_LIQUIDAZIONE AND
    lc.CD_UNITA_ORGANIZZATIVA = lgc.CD_UNITA_ORGANIZZATIVA AND
    lgcd.CD_CDS = lgc2.CD_CDS AND
    lgcd.ESERCIZIO = lgc2.ESERCIZIO AND
    lgcd.PG_LIQUIDAZIONE = lgc2.PG_LIQUIDAZIONE AND
    lgcd.CD_UNITA_ORGANIZZATIVA = lgc2.CD_UNITA_ORGANIZZATIVA AND
    lgcd.CD_CDS_ORIGINE = lgc2.CD_CDS_ORIGINE AND
    lgcd.CD_GRUPPO_CR = lgc2.CD_GRUPPO_CR AND
    lgcd.PG_LIQUIDAZIONE_ORIGINE = lgc2.PG_LIQUIDAZIONE_ORIGINE AND
    lgcd.CD_UO_ORIGINE = lgc2.CD_UO_ORIGINE AND
    lgcd.CD_REGIONE = lgc2.CD_REGIONE AND
    lgcd.PG_COMUNE = lgc2.PG_COMUNE AND
    gc.CD_GRUPPO_CR = LGCD.CD_GRUPPO_CR AND
    gc.ESERCIZIO = lgcd.ESERCIZIO AND
    LGCD.CD_REGIONE = r2.CD_REGIONE  AND
    LGCD.PG_COMUNE = C2.pg_comune AND
    tcr.CD_CONTRIBUTO_RITENUTA = cr.CD_CONTRIBUTO_RITENUTA AND
    TCR.DT_INI_VALIDITA = CR.DT_INI_VALIDITA AND
    cr.CD_CDS = LGCD.CD_CDS_ORIGINE AND
    cr.CD_UNITA_ORGANIZZATIVA = LGCD.CD_UO_ORIGINE AND
    cr.ESERCIZIO = lgcd.ESERCIZIO_CONTRIBUTO_RITENUTA AND
    cr.PG_COMPENSO = LGCD.PG_COMPENSO AND
    cr.CD_CONTRIBUTO_RITENUTA = lgcd.CD_CONTRIBUTO_RITENUTA AND
    cr.TI_ENTE_PERCIPIENTE = lgcd.TI_ENTE_PERCIPIENTE AND
    cr.CD_CDS = c3.CD_CDS AND
    cr.CD_UNITA_ORGANIZZATIVA = c3.CD_UNITA_ORGANIZZATIVA AND
    cr.ESERCIZIO = c3.ESERCIZIO AND
    cr.PG_COMPENSO = c3.PG_COMPENSO AND
    LGC2.ESERCIZIO = lgc.ESERCIZIO AND
    LGC2.PG_GRUPPO_CENTRO = lgc.PG_GRUPPO_CENTRO AND
    LGC2.CD_GRUPPO_CR = lgc.CD_GRUPPO_CR AND
    LGC2.CD_REGIONE = lgc.CD_REGIONE AND
    LGC2.PG_COMUNE = lgc.PG_COMUNE AND
    UO2.CD_UNITA_ORGANIZZATIVA = LC.CD_UNITA_ORGANIZZATIVA AND
    UO.CD_UNITA_ORGANIZZATIVA = c3.CD_UNITA_ORGANIZZATIVA AND
	ma.cd_cds = lgc.cd_cds_doc AND
	ma.esercizio = lgc.esercizio_doc AND
	ma.pg_mandato = lgc.pg_doc AND
    lgc.fl_accentrato = 'N' AND
    lgc.CD_UO_ORIGINE = '999.000' AND
    lgc2.fl_accentrato = 'Y'
UNION ALL
SELECT distinct lc.CD_UNITA_ORGANIZZATIVA, lc.PG_LIQUIDAZIONE , lgc.PG_DOC numero_mandato, lgc.CD_GRUPPO_CR,  gc.DS_GRUPPO_CR,  r2.DS_REGIONE , c2.DS_COMUNE, ma.IM_MANDATO - nvl(ma.IM_RITENUTE,0), tcr.cd_CONTRIBUTO_RITENUTA, tcr.ds_CONTRIBUTO_RITENUTA,lgcd.TI_ENTE_PERCIPIENTe, cr.AMMONTARE, c3.ESERCIZIO, c3.PG_COMPENSO, c3.CD_UNITA_ORGANIZZATIVA, UO.DS_UNITA_ORGANIZZATIVA , c3.DS_COMPENSO , C3.RAGIONE_SOCIALE , c3.COGNOME , c3.NOME, lc.ESERCIZIO, UO2.DS_UNITA_ORGANIZZATIVA, LGC.CD_CDS_DOC , LGC.ESERCIZIO_DOC, lc.dt_da, lc.dt_a, ma.dt_emissione, R2.CD_REGIONE ,C2.PG_COMUNE, c3.codice_fiscale
FROM LIQUID_CORI lc , LIQUID_GRUPPO_CORI lgc , LIQUID_GRUPPO_CORI_DET lgcd, GRUPPO_CR gc, REGIONE r2, COMUNE c2, TIPO_CONTRIBUTO_RITENUTA tcr, CONTRIBUTO_RITENUTA cr, COMPENSO c3 , UNITA_ORGANIZZATIVA uo, UNITA_ORGANIZZATIVA uo2, mandato ma
WHERE lc.CD_CDS = lgc.CD_CDS AND
	lc.ESERCIZIO = lgc.ESERCIZIO AND
	lc.PG_LIQUIDAZIONE = lgc.PG_LIQUIDAZIONE AND
	lc.CD_UNITA_ORGANIZZATIVA = lgc.CD_UNITA_ORGANIZZATIVA AND
	lgcd.CD_CDS = lgc.CD_CDS AND
	lgcd.ESERCIZIO = lgc.ESERCIZIO AND
	lgcd.PG_LIQUIDAZIONE = lgc.PG_LIQUIDAZIONE AND
	lgcd.CD_UNITA_ORGANIZZATIVA = lgc.CD_UNITA_ORGANIZZATIVA AND
	lgcd.CD_CDS_ORIGINE = lgc.CD_CDS_ORIGINE AND
	lgcd.CD_GRUPPO_CR = lgc.CD_GRUPPO_CR AND
	lgcd.PG_LIQUIDAZIONE_ORIGINE = lgc.PG_LIQUIDAZIONE_ORIGINE AND
	lgcd.CD_UO_ORIGINE = lgc.CD_UO_ORIGINE AND
	lgcd.CD_REGIONE = lgc.CD_REGIONE AND
	lgcd.PG_COMUNE = lgc.PG_COMUNE AND
	gc.CD_GRUPPO_CR = LGCD.CD_GRUPPO_CR AND
	gc.ESERCIZIO = lgcd.ESERCIZIO AND
	LGCD.CD_REGIONE = r2.CD_REGIONE(+)  AND
	LGCD.PG_COMUNE = C2.pg_comune(+) AND
	tcr.CD_CONTRIBUTO_RITENUTA = cr.CD_CONTRIBUTO_RITENUTA AND
    TCR.DT_INI_VALIDITA = CR.DT_INI_VALIDITA AND
	cr.CD_CDS = LGCD.CD_CDS_ORIGINE AND
	cr.CD_UNITA_ORGANIZZATIVA = LGCD.CD_UO_ORIGINE AND
	cr.ESERCIZIO = lgcd.ESERCIZIO_CONTRIBUTO_RITENUTA AND
	cr.PG_COMPENSO = LGCD.PG_COMPENSO AND
	cr.CD_CONTRIBUTO_RITENUTA = lgcd.CD_CONTRIBUTO_RITENUTA AND
	cr.TI_ENTE_PERCIPIENTE = lgcd.TI_ENTE_PERCIPIENTE AND
	cr.CD_CDS = c3.CD_CDS AND
	cr.CD_UNITA_ORGANIZZATIVA = c3.CD_UNITA_ORGANIZZATIVA AND
	cr.ESERCIZIO = c3.ESERCIZIO AND
	cr.PG_COMPENSO = c3.PG_COMPENSO AND
    UO.CD_UNITA_ORGANIZZATIVA = c3.CD_UNITA_ORGANIZZATIVA AND
    UO2.CD_UNITA_ORGANIZZATIVA = LC.CD_UNITA_ORGANIZZATIVA AND
	ma.cd_cds = lgc.cd_cds_doc AND
	ma.esercizio = lgc.esercizio_doc AND
	ma.pg_mandato = lgc.pg_doc AND
	lgc.fl_accentrato = 'N' AND
	lgc.CD_UO_ORIGINE != '999.000'
ORDER BY 3, 5, 9, 6, 7, 15, 13, 14
