<?xml version='1.0' encoding='UTF-8'?>
<beans
		xmlns="http://www.springframework.org/schema/beans"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:jee="http://www.springframework.org/schema/jee"
	   	xmlns:task="http://www.springframework.org/schema/task"
		xmlns:context="http://www.springframework.org/schema/context"
		xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
						http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd
						http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
						http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-4.3.xsd">

	<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath*:META-INF/spring/*.properties</value>
				<value>classpath*:repository.properties</value>
			</list>
		</property>
		<property name="ignoreUnresolvablePlaceholders" value="true" />
	</bean>

	<context:component-scan base-package="it.cnr.contab.spring" />

    <import resource="classpath*:it/cnr/contab/storage/service/storage-service-context.xml"/>
    <import resource="classpath*:it/cnr/contab/service/sdi-client-service-context.xml"/>

	<jee:jndi-lookup id="offlineReportComponent"
   			jndi-name="java:global/SIGLA/sigla-ejb/BREPORTS_EJB_OfflineReportComponentSession"
   			resource-ref="false">
   	</jee:jndi-lookup>
	<jee:jndi-lookup id="gestioneLoginComponent"
   			jndi-name="java:global/SIGLA/sigla-ejb/CNRUTENZE00_NAV_EJB_GestioneLoginComponentSession"
   			resource-ref="false">
   	</jee:jndi-lookup>
	<jee:jndi-lookup id="ricezioneFattureService"
   			jndi-name="java:global/SIGLA/sigla-sdi/RicezioneFatture!it.cnr.contab.docamm00.ejb.RicezioneFatturePA"
   			resource-ref="false"/>
	<jee:jndi-lookup id="trasmissioneFattureService"
   			jndi-name="java:global/SIGLA/sigla-sdi/TrasmissioneFatture!it.cnr.contab.docamm00.ejb.TrasmissioneFatturePA"
   			resource-ref="false"/>
	<jee:jndi-lookup id="fatturaElettronicaPassivaComponentSession"
   			jndi-name="java:global/SIGLA/sigla-ejb/CNRDOCAMM00_EJB_FatturaElettronicaPassivaComponentSession"
   			resource-ref="false"/>
	<jee:jndi-lookup id="ricercaDocContComponentSession"
   			jndi-name="java:global/SIGLA/sigla-ejb/CNRCHIUSURA00_EJB_RicercaDocContComponentSession"
   			resource-ref="false"/>
	<jee:jndi-lookup id="docAmmFatturazioneElettronicaComponentSession"
   			jndi-name="java:global/SIGLA/sigla-ejb/CNRDOCAMM00_EJB_DocAmmFatturazioneElettronicaComponentSession"
   			resource-ref="false"/>
	<bean id="trovatoProperties" class="it.cnr.contab.docamm00.client.TrovatoProperties">
		<property name="trovatoTargetEndpoint" value="${TrovatoTargetEndpoint}" />
		<property name="trovatoSiglaRestClientUser" value="${TrovatoSiglaRestClientUser}" />
		<property name="trovatoSiglaRestClientPassword" value="${TrovatoSiglaRestClientPassword}" />
	</bean>
	<bean id="digitalPreservationProperties" class="it.cnr.contab.dp.DigitalPreservationProperties">
		<property name="digitalPreservationCodAmm" value="${DigitalPreservationCodAmm}" />
		<property name="digitalPreservationCodRegFA" value="${DigitalPreservationCodRegFA}" />
		<property name="digitalPreservationCodRegFP" value="${DigitalPreservationCodRegFP}" />
	</bean>
	<bean id="gson" class="com.google.gson.Gson"/>

	<bean id="printService" class="it.cnr.contab.reports.service.PrintService">
    	<property name="offlineReportComponent" ref="offlineReportComponent"/>
    	<property name="gson" ref="gson"/>
    </bean>

    <bean id="ldapService" class="it.cnr.contab.utenze00.service.LDAPService">
    	<property name="gestioneLoginComponent" ref="gestioneLoginComponent"/>
    </bean>


	<bean id="fatturaPassivaElettronicaService" class="it.cnr.contab.docamm00.service.FatturaPassivaElettronicaService">
		<property name="fatturaElettronicaPassivaComponentSession" ref="fatturaElettronicaPassivaComponentSession"/>
		<property name="docAmmFatturazioneElettronicaComponentSession" ref="docAmmFatturazioneElettronicaComponentSession"/>
		<property name="ricercaDocContComponentSession" ref="ricercaDocContComponentSession"/>
		<property name="ricezioneFattureService" ref="ricezioneFattureService"/>
		<property name="trasmissioneFattureService" ref="trasmissioneFattureService"/>
		<property name="fatturazioneElettronicaClient" ref="fatturazioneElettronicaClient"/>
		<property name="pecScanDisable" value="${pec.scan.disable}"/>
		<property name="pecHostName" value="${pec.host.name}"/>

		<property name="pecURLName" value="${pec.url.name}"/>
		<property name="pecHostAddress" value="${pec.host.address}"/>
		<property name="pecHostAddressReturn" value="${pec.host.address.return}"/>
		<property name="pecSDIAddress" value="${pec.sdi.address}"/>
		<property name="pecSDIFromStringTerm" value="${pec.sdi.from.string.term}"/>
		<property name="pecSDISubjectRiceviFattureTerm" value="${pec.sdi.subject.ricevi.fatture.term}"/>
		<property name="pecScanFolderName" value="${pec.scan.folder.name}"/>
		<property name="pecScanReceiptFolderName" value="${pec.scan.receipt.folder.name}"/>

		<property name="pecSDISubjectFatturaAttivaRicevutaConsegnaTerm" value="${pec.sdi.subject.fatturaAttiva.notifica.ricevutaConsegna.term}"/>
		<property name="pecSDISubjectFatturaAttivaNotificaScartoTerm" value="${pec.sdi.subject.fatturaAttiva.notifica.scarto.term}"/>
		<property name="pecSDISubjectFatturaAttivaMancataConsegnaTerm" value="${pec.sdi.subject.fatturaAttiva.notifica.mancataConsegna.term}"/>
		<property name="pecSDISubjectNotificaEsitoTerm" value="${pec.sdi.subject.notifica.esito.term}"/>
		<property name="pecSDISubjectFatturaAttivaDecorrenzaTerminiTerm" value="${pec.sdi.subject.fatturaAttiva.notifica.decorrenzaTermini.term}"/>
		<property name="pecSDISubjectFatturaAttivaAttestazioneTrasmissioneFatturaTerm" value="${pec.sdi.subject.fatturaAttiva.notifica.attestazioneTrasmissioneFattura.term}"/>
		<property name="pecSDISubjectFatturaAttivaInvioTerm" value="${pec.sdi.subject.fatturaAttiva.invio.term}"/>
		<property name="pecSDISubjectMancataConsegnaPecTerm" value="${pec.sdi.subject.fatturaAttiva.mancataConsegna.term}"/>
		<property name="pecSDISubjectNotificaPecTerm" value="${pec.sdi.subject.notificaPec.term}"/>
		<property name="pecSDISubjectFatturaPassivaNotificaScartoEsitoTerm" value="${pec.sdi.subject.fatturaPassiva.notifica.scartoEsito.term}"/>

		<property name="pecMailConf">
		    <props>
		      <prop key="mail.imap.host">${pec.mail.imap.host}</prop>
		      <prop key="mail.imap.auth">${pec.mail.imap.auth}</prop>
		      <prop key="mail.imap.ssl.enable">${pec.mail.imap.ssl.enable}</prop>
		      <prop key="mail.imap.port">${pec.mail.imap.port}</prop>
		      <prop key="mail.imap.socketFactory.class">${pec.mail.imap.socketFactory.class}</prop>
		      <prop key="mail.imap.connectiontimeout">${pec.mail.imap.connectiontimeout}</prop>
		      <prop key="mail.imap.timeout">${pec.mail.imap.timeout}</prop>
		    </props>
		  </property>
	</bean>

	<bean name="props-aruba" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
	    <property name="properties">
	        <value>
	            arubaRemoteSignService.certId=${arubaRemoteSignService.certId}
	            arubaRemoteSignService.typeOtpAuth=${arubaRemoteSignService.typeOtpAuth}
	            arubaRemoteSignService.url=${arubaRemoteSignService.url}
	        </value>
	    </property>
	</bean>
	<bean id="arubaSignServiceClient" class="it.cnr.jada.firma.arss.ArubaSignServiceClient">
	  <property name="props" ref="props-aruba"></property>
	</bean>


  <!-- scheduler -->
  <task:scheduled-tasks scheduler="siglaScheduler">
    <task:scheduled ref="fatturaPassivaElettronicaService" method="allineaNotificheExecute" cron="${allinea.notifiche.cron.expression}" />
    <task:scheduled ref="fatturaPassivaElettronicaService" method="execute" cron="${pec.cron.expression}" />
  </task:scheduled-tasks>

  <task:scheduler id="siglaScheduler"  pool-size="10"/>

  <task:executor id="siglaTaskExecutor" pool-size="5"/>
  <task:annotation-driven  executor="siglaTaskExecutor" scheduler="siglaScheduler"/>
  <!-- / scheduler -->
</beans>